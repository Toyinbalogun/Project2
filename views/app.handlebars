<nav class="navbar is-fixed-bottom is-flex-mobile is-grouped" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="#">
            <img src="https://i.imgur.com/MdLJmhE.png" alt="Task.it - Task management made easy" width="112"
                height="28" />
        </a>
        <p class="navbar-item ">
            <button id="btn-add" class="button is-primary">
                Add Task
            </button>
        </p>
        <p class="navbar-item ">
            <button id="btn-edit" class="button is-primary">
                Edit Task
            </button>
        </p>
        <p class="navbar-item control">
            <button id="btn-delete" class="button is-danger">
                Delete Task
            </button>
        </p>
    </div>
</nav>




<section class="section">
    <div class="container">
        <h1 class="title">
            Task.it
        </h1>
        <p class="subtitle">Task management, made easy.</p>
    </div>
</section>
<div class="container">
    <div class="columns">
        <div class="column" id="sidebar">
            {{#each tasks}}
            <div class="box">
                <p>Task Name: {{this.taskName}} </p>
                <p>Task Description: {{this.taskDescription}}</p>
                <p>Task Deadline: {{this.taskDeadline}}</p>
            </div>
            {{/each}}
        </div>
        {{!-- <div class="column" id="content">
            <div class="box"></div>
        </div> --}}
    </div>
</div>
{{!-- modal window for the form used to add task --}}
<div class="modal" id="add-task-modal">
    <div class="modal-background"></div>
    <div class="modal-content">
        <div class="box">
            <h1>Add a Task</h1>
            <hr>

            {{!-- Form for adding a task --}}
            <form action="" id="add-task-form">
                <div class="field">
                    <label class="label" for="taskName">Task Name</label>
                    <div class="control">
                        <input name="taskName" id="taskName" class="input" type="text"
                            placeholder="Enter a name for this task">
                    </div>
                </div>

                <div class="field">
                    <label class="label" for="taskDescription">Task Description</label>
                    <div class="control">
                        <textarea id="taskDescription" name="taskDescription" class="textarea"
                            placeholder="Enter what the task is about"></textarea>
                    </div>
                </div>

                <div class="field">
                    <label class="label" for="taskDeadline">Task Deadline</label>
                    <div class="control">
                        <input name="taskDeadline" id="taskDeadline" class="input" type="text"
                            placeholder="When should this task expire">
                    </div>
                </div>

                <div class="control">
                    <button class="button is-primary" type="submit">Submit</button>
                </div>
            </form>
        </div>
    </div>
    <button class="modal-close is-large" aria-label="close"></button>
</div>

<!---->

<div class="modal" id="delete-task-modal">
    <div class="modal-background"></div>
    <div class="modal-content">
        <div class="box">
            {{#each tasks}}
            <div class="box">
                <p>Task Name: {{this.taskName}} </p>
                <p>Task Description: {{this.taskDescription}}</p>
                <p>Task Deadline: {{this.taskDeadline}}</p>
                <div class="control">
                    <button class="button is-danger" type="delete">Delete</button>
                </div>
            </div>
            {{/each}}
        </div>
    </div>
    <button class="modal-close is-large" aria-label="close"></button>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {

        // Event handler to open add task modal window
        document.getElementById("btn-add").addEventListener("click", event => {
            document.documentElement.classList.add("is-clipped")
            document.getElementById("add-task-modal").classList.add("is-active")
        })

        document.querySelectorAll('.modal-close').forEach(element => {
            element.addEventListener("click", event => {
                document.getElementById("add-task-modal").classList.remove("is-active")
                document.documentElement.classList.remove("is-clipped")
            })

        })

        // Delete

        document.getElementById("btn-delete").addEventListener("click", event => {
            document.documentElement.classList.add("is-clipped")
            document.getElementById("delete-task-modal").classList.add("is-active")
        })

        document.querySelectorAll('.modal-close').forEach(element => {
            element.addEventListener("click", event => {
                document.getElementById("delete-task-modal").classList.remove("is-active")
                document.documentElement.classList.remove("is-clipped")
            })

        })

        // Edit Tasks


        // Event handler for submitting the add task form
        document.getElementById("add-task-form").addEventListener("submit", event => {
            event.preventDefault();

            const newTask = {
                taskName: document.querySelector("[name=taskName]").value.trim(),
                taskDescription: document.querySelector("[name=taskDescription]").value.trim(),
                taskDeadline: document.querySelector("[name=taskDeadline]").value.trim(),
            }

            fetch(`/api/tasks`, {
                method: 'POST',
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(newTask)
            }).then(response => {
                console.log(response)
                location.reload()
            })
        })

        // Event handler for Delete

        document.getElementById("delete-task-form").addEventListener("delete", event => {
            event.preventDefault();

            const newTask = {
                taskName: document.querySelector("[name=taskName]").value.trim(),
                taskDescription: document.querySelector("[name=taskDescription]").value.trim(),
                taskDeadline: document.querySelector("[name=taskDeadline]").value.trim(),
            }

            fetch(`/api/tasks`, {
                method: 'POST',
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(newTask)
            }).then(response => {
                console.log(response)
            })
        })

    })
</script>